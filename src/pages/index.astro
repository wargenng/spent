---
import PaymentCard from "@/components/paymentcard.astro";
import { Button } from "@/components/ui/button";
import "@/styles/globals.css";
import type { Payment as PaymentType } from "@/types/db";
import { db, desc, eq, Payment } from "astro:db";
import Layout from "../layouts/Layout.astro";

const userId = String(Astro.locals.auth().userId);
if (!userId) {
    return;
}
const payments = await db
    .select()
    .from(Payment)
    .where(eq(Payment.userId, userId))
    .orderBy(desc(Payment.date));
---

<Layout title="Home">
    <div class="space-y-4 p-4">
        <a href="/paymentform">
            <Button>Payment Entry</Button>
        </a>
        <h2>Purchases</h2>
        {
            payments.map((payment: PaymentType) => (
                <PaymentCard payment={payment} />
            ))
        }
    </div>
</Layout>
