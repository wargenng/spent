---
import Welcome from "@/components/welcome.astro";
import "@/styles/globals.css";
import { Categories, db, desc, eq, Transactions } from "astro:db";
import Layout from "../layouts/Layout.astro";
import { Cards } from "astro:db";
import { getUserPaychecks } from "@/service/queries";

const userId = String(Astro.locals.auth().userId);
if (!userId) {
    return;
}
const payments = await db
    .select()
    .from(Transactions)
    .where(eq(Transactions.userId, userId))
    .orderBy(desc(Transactions.date), desc(Transactions.id));

const categories = await db.select().from(Categories).all();
const cards = await db.select().from(Cards).where(eq(Cards.userId, userId));
const paychecks = await getUserPaychecks(userId);
---

<Layout title="spent">
    <div class="space-y-8 w-full flex items-center justify-center flex-col">
        <Welcome
            userId={userId}
            paychecks={paychecks}
            payments={payments}
            categories={categories}
            cards={cards}
        />
    </div>
</Layout>
